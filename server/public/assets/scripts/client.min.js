var app=angular.module("sportApp",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){a.state("login",{url:"/",templateUrl:"views/login.html",controller:"LoginController"}).state("home",{url:"/home",templateUrl:"views/home.html",controller:"HomeController"}).state("assets",{url:"/assets",templateUrl:"views/assets.html",controller:"AssetsController"}).state("new_reservation",{url:"/new_reservation",templateUrl:"views/new_reservation.html",controller:"NewReservationController"}).state("reservations",{url:"/reservations",templateUrl:"views/reservations.html",controller:"ReservationsController"}).state("edit_reservation",{url:"/edit_reservation",templateUrl:"views/edit_reservation.html",controller:"EditReservationController"}).state("new_asset",{url:"/new_asset",templateUrl:"views/new_asset.html",controller:"NewAssetController"}).state("view_assets",{url:"/view_assets",templateUrl:"views/view_assets.html",controller:"ViewAssetsController"}).state("calendar",{url:"/calendar",templateUrl:"views/calendar.html",controller:"CalendarController"}).state("edit_asset",{url:"/edit_asset",templateUrl:"views/edit_asset.html",controller:"EditAssetController"}).state("available_assets",{url:"/available_assets",templateUrl:"views/available_assets.html",controller:"AvailableAssetsController"}),c.html5Mode(!0)}]),app.controller("LoginController",["$scope","$http","$location","$window","ReservationService",function(a,b,c,d,e){a.login=function(){d.location="/login"},b.get("/loggedIn").then(function(a){a.data&&c.path("/home")})}]),app.controller("HomeController",["$scope","ReservationService",function(a,b){b.getReservations(),b.getEvents(),a.data=b.data}]),app.controller("AssetsController",["$scope",function(a){}]),app.controller("NewReservationController",["$scope","$http","$location","ReservationService",function(a,b,c,d){d.getEvents(),d.getAssets(),a.data=d.data,a.selectedEvent="",a.selectedAssets=[],a.reservedBy="",a.createReservation=function(){for(var d=0;d<a.data.assets.length;d++)a.data.assets[d].selected===!0&&a.selectedAssets.push(parseInt(a.data.assets[d].id));b.post("internal/reservation",{eventId:a.selectedEvent.id,selectedAssets:a.selectedAssets,reservedBy:a.reservedBy}).then(function(a){200===a.status?c.path("/reservations"):console.log("error")})}}]),app.controller("ReservationsController",["$scope","$http","$location","ReservationService",function(a,b,c,d){d.getReservations(),d.getAssets(),d.getEvents(),a.data=d.data,a.editReservation=function(a){d.data.reservationToEdit=a,c.path("edit_reservation")}}]),app.controller("EditReservationController",["ReservationService","$http","$scope","$location",function(a,b,c,d){c.data=a.data;var e=a.data.reservationToEdit;c.reservedBy=e.reserved_by,c.selectedAssets=[];for(var f=0;f<e.assets.length;f++)for(var g=0;g<c.data.assets.length;g++)if(e.assets[f]===c.data.assets[g].name){c.data.assets[g].selected=!0;break}for(var h=0;h<c.data.events.length;h++)if(parseInt(e.event_id)===c.data.events[h].id){c.selectedEvent=c.data.events[h];break}c.updateReservation=function(){for(var a=0;a<c.data.assets.length;a++)c.data.assets[a].selected===!0&&c.selectedAssets.push(parseInt(c.data.assets[a].id));b.put("internal/reservation",{id:e.id,eventId:c.selectedEvent.id,selectedAssets:c.selectedAssets,reservedBy:c.reservedBy}).then(function(a){200===a.status?d.path("/reservations"):console.log("error")})},c.deleteReservation=function(){b["delete"]("/internal/reservation/"+e.id).then(function(b){200===b.status?(a.getReservations(),d.path("/reservations")):console.log("error deleting reservation")})}}]),app.controller("CalendarController",["$scope","$http","ReservationService",function(a,b,c){c.getEvents(),a.data=c.data}]),app.controller("NewAssetController",["$scope","$http","$location",function(a,b,c){a.data={},a.categoryList=["Practice","Player Equipment","Game","Other"],a.submitAsset=function(){console.log(a.data),b({url:"/internal/newAsset",method:"POST",params:{name:a.data.name,description:a.data.description,category:a.data.category,notes:a.data.notes}}).then(function(a){c.path(a.data)})}}]),app.controller("AvailableAssetsController",["$scope",function(a){}]),app.controller("ViewAssetsController",["$scope","$http","$location","currentAsset",function(a,b,c,d){a.assets=[],a.sortBy="Name",a.sortOptions=["Category","Name","Recently Created"],a.searchKeyword="",a.getAssets=function(){var c="%"+a.searchKeyword+"%";b({url:"/internal/getAssets",method:"GET",params:{sortBy:a.sortBy,keyword:c}}).then(function(b){a.assets=b.data})},a.getAssets(),a.editAsset=function(a){d.setAsset(a),c.path("edit_asset")},a.viewReservations=function(a){console.log(a),b.get("internal/assetReservations/"+a).then(function(a){console.log(a.data)})}}]),app.controller("EditAssetController",["$scope","$http","$location","currentAsset",function(a,b,c,d){a.data=d.currentAsset,a.categoryList=["Practice","Player Equipment","Game","Other"],a.updateAsset=function(){console.log(a.data),b({url:"/internal/updateAsset",method:"POST",params:{name:a.data.name,description:a.data.description,category:a.data.category,notes:a.data.notes,id:a.data.id}}).then(function(a){c.path(a.data)})},a.deleteAsset=function(){b["delete"]("/internal/asset/"+a.data.id).then(function(a){200===a.status?c.path("/view_assets"):console.log("error deleting asset")})},a.goBack=function(){window.history.back()}}]),app.factory("currentAsset",["$http",function(a){var b={},c=function(a){b.id=a.id,b.name=a.name,b.description=a.description,b.category=a.category,b.notes=a.notes},d=function(){b={}};return{currentAsset:b,setAsset:c,clearCurrentAsset:d}}]),app.factory("ReservationService",["$http",function(a){var b={},c=function(){var c,d;a.get("/api/siteList").then(function(e){c=e.data[0],d=c.id,a.get("/api/eventList/"+d).then(function(a){b.events=a.data.events})})},d=function(){a.get("internal/getAssets").then(function(a){b.assets=a.data})},e=function(){a.get("internal/getReservations").then(function(a){b.reservations=a.data})};return{data:b,getEvents:c,getAssets:d,getReservations:e}}]);